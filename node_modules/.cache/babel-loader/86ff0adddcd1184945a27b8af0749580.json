{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.UserWallet = void 0;\n\nconst userKeys_1 = require(\"./userKeys\");\n\nconst crypto_1 = require(\"../crypto\");\n\nconst derivationParams_1 = require(\"../crypto/derivationParams\");\n\nclass UserWallet {\n  /**\n   * Copied from: https://github.com/ElrondNetwork/elrond-core-js/blob/v1.28.0/src/account.js#L76\n   * Notes: adjustements (code refactoring, no change in logic), in terms of:\n   *  - typing (since this is the TypeScript version)\n   *  - error handling (in line with erdjs's error system)\n   *  - references to crypto functions\n   *  - references to object members\n   *\n   * Given a password, generates the contents for a file containing the account's secret key,\n   * passed through a password-based key derivation function (kdf).\n   */\n  constructor(secretKey, password) {\n    let randomness = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new crypto_1.Randomness();\n    const text = Buffer.concat([secretKey.valueOf(), secretKey.generatePublicKey().valueOf()]);\n    this.encryptedData = crypto_1.Encryptor.encrypt(text, password, randomness);\n    this.publicKey = secretKey.generatePublicKey();\n  }\n  /**\n   * Copied from: https://github.com/ElrondNetwork/elrond-core-js/blob/v1.28.0/src/account.js#L42\n   * Notes: adjustements (code refactoring, no change in logic), in terms of:\n   *  - typing (since this is the TypeScript version)\n   *  - error handling (in line with erdjs's error system)\n   *  - references to crypto functions\n   *  - references to object members\n   *\n   * From an encrypted keyfile, given the password, loads the secret key and the public key.\n   */\n\n\n  static decryptSecretKey(keyFileObject, password) {\n    const encryptedData = UserWallet.edFromJSON(keyFileObject);\n    let text = crypto_1.Decryptor.decrypt(encryptedData, password);\n\n    while (text.length < 32) {\n      let zeroPadding = Buffer.from([0x00]);\n      text = Buffer.concat([zeroPadding, text]);\n    }\n\n    let seed = text.slice(0, 32);\n    return new userKeys_1.UserSecretKey(seed);\n  }\n\n  static edFromJSON(keyfileObject) {\n    return new crypto_1.EncryptedData({\n      version: crypto_1.Version,\n      id: keyfileObject.id,\n      cipher: keyfileObject.crypto.cipher,\n      ciphertext: keyfileObject.crypto.ciphertext,\n      iv: keyfileObject.crypto.cipherparams.iv,\n      kdf: keyfileObject.crypto.kdf,\n      kdfparams: new derivationParams_1.ScryptKeyDerivationParams(keyfileObject.crypto.kdfparams.n, keyfileObject.crypto.kdfparams.r, keyfileObject.crypto.kdfparams.p, keyfileObject.crypto.kdfparams.dklen),\n      salt: keyfileObject.crypto.kdfparams.salt,\n      mac: keyfileObject.crypto.mac\n    });\n  }\n  /**\n   * Converts the encrypted keyfile to plain JavaScript object.\n   */\n\n\n  toJSON() {\n    return {\n      version: crypto_1.Version,\n      id: this.encryptedData.id,\n      address: this.publicKey.hex(),\n      bech32: this.publicKey.toAddress().toString(),\n      crypto: {\n        ciphertext: this.encryptedData.ciphertext,\n        cipherparams: {\n          iv: this.encryptedData.iv\n        },\n        cipher: crypto_1.CipherAlgorithm,\n        kdf: crypto_1.KeyDerivationFunction,\n        kdfparams: {\n          dklen: this.encryptedData.kdfparams.dklen,\n          salt: this.encryptedData.salt,\n          n: this.encryptedData.kdfparams.n,\n          r: this.encryptedData.kdfparams.r,\n          p: this.encryptedData.kdfparams.p\n        },\n        mac: this.encryptedData.mac\n      }\n    };\n  }\n\n}\n\nexports.UserWallet = UserWallet;","map":{"version":3,"sources":["../../src/walletcore/userWallet.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.UserWallet = void 0;\nconst userKeys_1 = require(\"./userKeys\");\nconst crypto_1 = require(\"../crypto\");\nconst derivationParams_1 = require(\"../crypto/derivationParams\");\nclass UserWallet {\n    /**\n     * Copied from: https://github.com/ElrondNetwork/elrond-core-js/blob/v1.28.0/src/account.js#L76\n     * Notes: adjustements (code refactoring, no change in logic), in terms of:\n     *  - typing (since this is the TypeScript version)\n     *  - error handling (in line with erdjs's error system)\n     *  - references to crypto functions\n     *  - references to object members\n     *\n     * Given a password, generates the contents for a file containing the account's secret key,\n     * passed through a password-based key derivation function (kdf).\n     */\n    constructor(secretKey, password, randomness = new crypto_1.Randomness()) {\n        const text = Buffer.concat([secretKey.valueOf(), secretKey.generatePublicKey().valueOf()]);\n        this.encryptedData = crypto_1.Encryptor.encrypt(text, password, randomness);\n        this.publicKey = secretKey.generatePublicKey();\n    }\n    /**\n     * Copied from: https://github.com/ElrondNetwork/elrond-core-js/blob/v1.28.0/src/account.js#L42\n     * Notes: adjustements (code refactoring, no change in logic), in terms of:\n     *  - typing (since this is the TypeScript version)\n     *  - error handling (in line with erdjs's error system)\n     *  - references to crypto functions\n     *  - references to object members\n     *\n     * From an encrypted keyfile, given the password, loads the secret key and the public key.\n     */\n    static decryptSecretKey(keyFileObject, password) {\n        const encryptedData = UserWallet.edFromJSON(keyFileObject);\n        let text = crypto_1.Decryptor.decrypt(encryptedData, password);\n        while (text.length < 32) {\n            let zeroPadding = Buffer.from([0x00]);\n            text = Buffer.concat([zeroPadding, text]);\n        }\n        let seed = text.slice(0, 32);\n        return new userKeys_1.UserSecretKey(seed);\n    }\n    static edFromJSON(keyfileObject) {\n        return new crypto_1.EncryptedData({\n            version: crypto_1.Version,\n            id: keyfileObject.id,\n            cipher: keyfileObject.crypto.cipher,\n            ciphertext: keyfileObject.crypto.ciphertext,\n            iv: keyfileObject.crypto.cipherparams.iv,\n            kdf: keyfileObject.crypto.kdf,\n            kdfparams: new derivationParams_1.ScryptKeyDerivationParams(keyfileObject.crypto.kdfparams.n, keyfileObject.crypto.kdfparams.r, keyfileObject.crypto.kdfparams.p, keyfileObject.crypto.kdfparams.dklen),\n            salt: keyfileObject.crypto.kdfparams.salt,\n            mac: keyfileObject.crypto.mac,\n        });\n    }\n    /**\n     * Converts the encrypted keyfile to plain JavaScript object.\n     */\n    toJSON() {\n        return {\n            version: crypto_1.Version,\n            id: this.encryptedData.id,\n            address: this.publicKey.hex(),\n            bech32: this.publicKey.toAddress().toString(),\n            crypto: {\n                ciphertext: this.encryptedData.ciphertext,\n                cipherparams: { iv: this.encryptedData.iv },\n                cipher: crypto_1.CipherAlgorithm,\n                kdf: crypto_1.KeyDerivationFunction,\n                kdfparams: {\n                    dklen: this.encryptedData.kdfparams.dklen,\n                    salt: this.encryptedData.salt,\n                    n: this.encryptedData.kdfparams.n,\n                    r: this.encryptedData.kdfparams.r,\n                    p: this.encryptedData.kdfparams.p\n                },\n                mac: this.encryptedData.mac,\n            }\n        };\n    }\n}\nexports.UserWallet = UserWallet;\n//# sourceMappingURL=userWallet.js.map"]},"metadata":{},"sourceType":"script"}